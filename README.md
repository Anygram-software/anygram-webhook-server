# anygram-webhook-server
Пример сервера получения, верификации и обработки вебхуков от Anygram-клиента.

Ниже короткая инструкция, как поднять вебхук-сервер из примера на своем сервере и подключить его к софту.

## 1) Установка


```bash
git clone https://github.com/Anygram-software/anygram-webhook-server.git
```

Установка зависимостей.
В репозитории есть requirements.txt и pyproject.toml, можно ставить так:

```bash
pip install -r requirements.txt
```

или через uv:

```bash
uv sync
```

## 2) Настройка

Установите в переменную окружения (или в коде в ANYGRAM_API_KEY для дебага) ваш апи ключ софта

```bash
export ANYGRAM_WEBHOOK_SECRET="changethis123"
```
Если апи ключ в софте не указан то по умочанию он будет установлен как "changethis123".
Обязательно установите свой собственный в настройках Anygram-клиента


По умолчанию он работает на http для удобства проксированния на него трафика с домена через nginx (что очень рекомендуется).

Слать запросы по http на голый айпишник без домена не рекомендуеться так как трафик на пути к серверу не имеет шифрования и его может прослушать/подменить кто угодно.

Если все же у вас нет домена с нормальным https сертификатом, то можете включить в коде
```
DEFAULT_SSL_SELF_SIGNED=True
```
Тогда при запуске сгенерируется самоподписной сертификат и сервер будет работает на https://{IP}:PORT
Также в настройках Anygram клиента разрешите подключаться к серверам с самоподписным сертификатом.
В этом случае ваш трафик между клиентом и сервером будет шифроваться, это лучше чем ничего, но не исключает MITM-атаки. 


Если вы хотите чтоб ваш порт на сервре был открыт на ружу, а не только локально, можете установить в коде
DEFAULT_BIND_ALL = True
тогда он станет доступным в глобальной сети. 
Также в примере есть возможность установить все эти переменные через перменные окружения. 

## 3) Запуск


```bash
python3 anygram_hooks.py
```

или через uv:

```bash
uv run anygram_hooks.py
```


Далее вебхук сервер станет доступен по пути 
```
http://{IP}:4545/anygram_hooks
```
или 
```
https://{IP}:4545/anygram_hooks (если задали в настройках)
```

Если порты открыты то можно вставлять эту ссылку в софт.

Если вы проксируете трафик с домена то ссылка будет:
```
https://{ВАШ ДОМЕН}/anygram_hooks
```

